<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TaCarla: Autonomous Driving Benchmark</title>

  <!-- Theme CSS (your style.css that I produced earlier) -->
  <link rel="stylesheet" href="style.css">

  <!-- KaTeX for fast math rendering + auto-render extension -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" crossorigin="anonymous"></script>

  <!-- MathJax fallback -->
  <script id="MathJax-script" defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    /* Small inline adjustments for safety (most styles in style.css) */
    .tex-content { white-space: pre-wrap; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="hero">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">TaCarla</h1>
        <p class="hero-subtitle">A comprehensive benchmarking dataset for end-to-end autonomous driving</p>

        <div class="authors">
          <span class="author">TaCarla Research Team</span>
          <span class="author">CARLA Leaderboard 2.0</span>
        </div>

        <div class="affiliations">
          <span class="affiliation">CARLA Simulation â€” Leaderboard 2.0 Scenarios</span>
        </div>

        <div class="action-buttons">
          <a class="btn btn-primary" href="#download">ðŸ“¥ Download</a>
          <a class="btn btn-secondary" href="#citation">ðŸ“‹ Cite</a>
          <a class="btn btn-secondary" href="https://github.com/atg93/TaCarla-Visualization" target="_blank" rel="noopener">ðŸ“Š Data Visualization</a>
        </div>
      </div>
    </div>
  </header>

  <!-- ABSTRACT: inlined from Abstract.tex -->
  <section class="section" id="abstract">
    <div class="container">
      <h2>Abstract</h2>

      <div class="tex-card" aria-live="polite">
        <div class="tex-title">
          <span>Abstract (inlined from <code>Abstract.tex</code>)</span>
        </div>

        <div id="abstract-tex-content" class="tex-content">
Collecting a high-quality dataset is a critical task that demand...ominantly drives forward, offering limited behavioral diversity.
The CARLA Leaderboard 2.0 challenge, providing a diverse set of ...ion exhibit suboptimal driving behaviors, such as oscillations. 
To support end-to-end autonomous driving research, we have colle...e its versatility by training various models using our dataset. 
        </div>
      </div>

      <p class="small-muted" style="margin-top:10px">
        Note: LaTeX math in the Abstract will be rendered by KaTeX. MathJax is available as a fallback for any constructs KaTeX cannot render.
      </p>
    </div>
  </section>

  <!-- EXPERIMENTS: inlined if present, otherwise helpful placeholder -->
  <section class="section" id="experiments">
    <div class="container">
      <h2>Experiments</h2>

      <div class="tex-card">
        <div class="tex-title">
          <span>Experiments (from <code>chapter/Experiments.tex</code>)</span>
        </div>

        <div id="experiments-tex-content" class="tex-content">
Loading Experiments... (attempting to inline chapter/Experiments.tex)
        </div>
      </div>

      <p class="small-muted" style="margin-top:10px">
        If Experiments content doesn't appear, place <code>chapter/Experiments.tex</code> in your site's public folder so it can be read and inlined automatically.
      </p>
    </div>
  </section>

  <!-- Visualization -->
  <section class="section" id="visualization">
    <div class="container">
      <h2>Visualization</h2>
      <p class="small-muted">
        Explore interactive visualization tools: <a href="https://github.com/atg93/TaCarla-Visualization" target="_blank" rel="noopener">TaCarla-Visualization (GitHub)</a>
      </p>

      <div class="figure-container">
        <div class="image-container">
          <img src="images/bev.png" alt="BEV Visualization" data-full="images/bev.png" loading="lazy">
        </div>
        <div class="figure-caption"><strong>BEV Visualization</strong> â€” click to open.</div>
      </div>
    </div>
  </section>

  <!-- Citation -->
  <section class="section" id="citation">
    <div class="container">
      <h2>Citation</h2>
      <div class="citation-box">
        <pre id="citation-text">@inproceedings{2025tacarla,
  title   = {TaCarla: A comprehensive benchmarking dataset for end-to-end autonomous driving},
  author  = {TaCarla Research Team},
  year    = {2025}
}</pre>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="btn btn-primary" id="copyCitation">ðŸ“‹ Copy Citation</button>
        </div>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <p>Â© 2025 TaCarla Team</p>
      <p>Contact: <a href="mailto:team@tacarla.example">team@tacarla.example</a></p>
    </div>
  </footer>

  <!-- Image modal -->
  <div id="imageModal" class="image-modal" role="dialog" aria-hidden="true">
    <div class="close-modal" id="closeModal" title="Close">&times;</div>
    <img id="modalImage" src="" alt="Full size" />
  </div>

  <!-- Inline script: attempt to fetch Experiments.tex from chapter/ and render math -->
  <script>
    // Lightweight LaTeX stripping (keeps $..$ and $$..$$ for math renderers)
    function stripTex(txt){
      if (!txt) return '';
      let s = txt.replace(/%[^\n]*/g, ''); // remove LaTeX comments
      // remove begin/end abstract if present (we already inline full abstract)
      s = s.replace(/\\begin\{abstract\}([\s\S]*?)\\end\{abstract\}/m, (m,g1)=>g1);
      // remove commonly safe commands but keep math delimiters
      s = s.replace(/\\(cite|ref|label)\{[^\}]*\}/g,'');
      s = s.replace(/\\(begin|end)\{[^\}]*\}/g,'');
      // remove other backslash commands but keep $ and $$ intact
      s = s.replace(/\\[a-zA-Z]+\*?(?:\[[^\]]*\])?(?:\{[^\}]*\})?/g,'');
      s = s.replace(/\n{3,}/g, '\n\n');
      return s.trim();
    }

    // render math in an element using KaTeX auto-render when available; fallback to MathJax
    function renderMathInElementIfAvailable(rootEl){
      if (!rootEl) return;
      if (window.renderMathInElement){
        try {
          renderMathInElement(rootEl, {
            delimiters: [
              {left: '\\\\(', right: '\\\\)', display: false},
              {left: '\\\\[', right: '\\\\]', display: true},
              {left: '$$', right: '$$', display: true},
              {left: '$', right: '$', display: false}
            ],
            ignoredTags: ['script','noscript','style','textarea','pre','code']
          });
          return;
        } catch (e){
          console.warn('KaTeX render failed. Falling back to MathJax if available.', e);
        }
      }
      if (window.MathJax && MathJax.typesetPromise){
        MathJax.typesetPromise([rootEl]).catch((err)=>console.warn('MathJax typeset failed', err));
      }
    }

    // Try to fetch experiments tex from common locations and inline it
    async function inlineExperiments(){
      const el = document.getElementById('experiments-tex-content');
      if (!el) return;
      const candidates = ['chapter/Experiments.tex','chapter/experiments.tex','Experiments.tex','experiments.tex'];
      for (const path of candidates){
        try {
          const resp = await fetch(path);
          if (!resp.ok) continue;
          const txt = await resp.text();
          const stripped = stripTex(txt);
          el.textContent = stripped || '(Experiments.tex was empty after stripping LaTeX.)';
          renderMathInElementIfAvailable(el);
          return;
        } catch (err){
          // ignore and try next
        }
      }
      // If none found, show friendly message
      el.textContent = 'Experiments.tex not found in chapter/ or site root. Upload/place chapter/Experiments.tex to have it inlined automatically.';
    }

    // image modal
    function setupImageModal(){
      document.querySelectorAll('img[data-full]').forEach(img=>{
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', ()=>{
          const modal = document.getElementById('imageModal');
          const modalImg = document.getElementById('modalImage');
          modalImg.src = img.dataset.full || img.src;
          modal.classList.add('active');
          modal.setAttribute('aria-hidden','false');
        });
      });
      const closeBtn = document.getElementById('closeModal');
      if (closeBtn) closeBtn.addEventListener('click', ()=>{
        const modal = document.getElementById('imageModal');
        modal.classList.remove('active');
        modal.setAttribute('aria-hidden','true');
        document.getElementById('modalImage').src = '';
      });
      document.addEventListener('keydown', (e)=>{ if (e.key==='Escape'){
        const modal=document.getElementById('imageModal'); if(modal && modal.classList.contains('active')){
          modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); document.getElementById('modalImage').src='';
        }
      }});
    }

    // copy citation
    function setupCopyCitation(){
      const btn = document.getElementById('copyCitation');
      if (!btn) return;
      btn.addEventListener('click', async ()=>{
        const text = document.getElementById('citation-text').innerText;
        try {
          await navigator.clipboard.writeText(text);
          btn.textContent = 'âœ… Copied!';
          setTimeout(()=> btn.textContent = 'ðŸ“‹ Copy Citation', 1500);
        } catch (err){
          alert('Could not copy automatically. Here is the citation:\\n\\n' + text);
        }
      });
    }

    // On DOM ready
    document.addEventListener('DOMContentLoaded', ()=>{
      setupImageModal();
      setupCopyCitation();

      // Render math in inlined abstract block (abstract is inlined in HTML)
      const absEl = document.getElementById('abstract-tex-content');
      renderMathInElementIfAvailable(absEl);

      // Attempt to inline experiments.tex from server
      inlineExperiments();
    });
  </script>
</body>
</html>
